"use strict";(self.webpackChunkbee_js_docs=self.webpackChunkbee_js_docs||[]).push([[988],{5680:(e,t,a)=>{a.d(t,{xA:()=>c,yg:()=>h});var n=a(6540);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var l=n.createContext({}),g=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},c=function(e){var t=g(e.components);return n.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=g(a),u=i,h=p["".concat(l,".").concat(u)]||p[u]||d[u]||o;return a?n.createElement(h,r(r({ref:t},c),{},{components:a})):n.createElement(h,r({ref:t},c))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:i,r[1]=s;for(var g=2;g<o;g++)r[g]=a[g];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}u.displayName="MDXCreateElement"},8775:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>d,frontMatter:()=>o,metadata:()=>s,toc:()=>g});var n=a(8168),i=(a(6540),a(5680));const o={title:"Buying Storage",id:"storage",slug:"/storage",sidebar_label:"Buying Storage"},r=void 0,s={unversionedId:"documentation/storage",id:"documentation/storage",title:"Buying Storage",description:"\x3c!--",source:"@site/docs/documentation/buying-storage.md",sourceDirName:"documentation",slug:"/storage",permalink:"/docs/storage",draft:!1,editUrl:"https://github.com/ethersphere/bee-js-docs/docs/documentation/buying-storage.md",tags:[],version:"current",frontMatter:{title:"Buying Storage",id:"storage",slug:"/storage",sidebar_label:"Buying Storage"},sidebar:"Balls",previous:{title:"Chequebook Management",permalink:"/docs/chequebook"},next:{title:"Upload and Download",permalink:"/docs/upload-download"}},l={},g=[{value:"Requirements",id:"requirements",level:3},{value:"Checking Storage Costs",id:"checking-storage-costs",level:3},{value:"Purchasing Storage",id:"purchasing-storage",level:3},{value:"Extending Storage Size",id:"extending-storage-size",level:3},{value:"Extending Storage Duration",id:"extending-storage-duration",level:3},{value:"Estimating Combined Size and Duration Extension Cost",id:"estimating-combined-size-and-duration-extension-cost",level:3},{value:"Checking Batch Status",id:"checking-batch-status",level:3},{value:"Selecting a Batch",id:"selecting-a-batch",level:3},{value:"Batch Size Breakpoints",id:"batch-size-breakpoints",level:3},{value:"Utility Classes",id:"utility-classes",level:3},{value:"<code>Size</code>",id:"size",level:4},{value:"Creating a Size instance",id:"creating-a-size-instance",level:5},{value:"Converting and formatting",id:"converting-and-formatting",level:5},{value:"<code>Duration</code>",id:"duration",level:4},{value:"Creating a Duration instance",id:"creating-a-duration-instance",level:5},{value:"Converting and formatting",id:"converting-and-formatting-1",level:5}],c={toc:g},p="wrapper";function d(e){let{components:t,...a}=e;return(0,i.yg)(p,(0,n.A)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,i.yg)("p",null,'Storage on Swarm is rented by purchasing "postage stamp batches". Each batch entitles its owner to store a certain amount of storage space on Swarm for the lifetime of the batch. The cost of the batch increases with the storage size and duration. '),(0,i.yg)("h3",{id:"requirements"},"Requirements"),(0,i.yg)("p",null,"To use the example scripts below, you need:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"An instance of ",(0,i.yg)("inlineCode",{parentName:"li"},"bee-js"),"'s ",(0,i.yg)("inlineCode",{parentName:"li"},"Bee")," ",(0,i.yg)("a",{parentName:"li",href:"/docs/getting-started/"},"initialized")," using the API endpoint of a currently operating Bee node ")),(0,i.yg)("h3",{id:"checking-storage-costs"},"Checking Storage Costs"),(0,i.yg)("p",null,"We can use the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.getStorageCost")," method along with our desired storage ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," (amount of data to upload) and ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," (the batch lifetime) to get an estimated storage cost:"),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"The per byte storage cost decreases as the storage ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," of the batch increases, so it is more cost effective to purchase a single large batch rather than multiple smaller ones."),(0,i.yg)("p",{parentName:"admonition"},"Costs remain constant with respect to changes in total ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration"),", however, so there is no discount for purchasing batches with longer lifetime. ")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},'import { Bee, Size, Duration } from "@ethersphere/bee-js"\n\nconst bee = new Bee(\'http://localhost:1633\')\n\n// Get cost in BZZ to store 4 GB for ~1 day\nconst bzz = await bee.getStorageCost(Size.fromGigabytes(1), Duration.fromDays(1))\n\n// Prints "0.325" given the storage cost of 44908 PLUR at time of writing\nconsole.log(bzz.toSignificantDigits(3)) \n')),(0,i.yg)("admonition",{type:"warning"},(0,i.yg)("p",{parentName:"admonition"},"The actual lifetime of the batch may be higher or lower than the specified ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," due to Swarm's dynamic pricing model."),(0,i.yg)("p",{parentName:"admonition"},"The amount that the price can change each day is limited, however, so you don't need to worry about a rapid increase in price causing your batch to unexpectedly expire over the course of a few hours.      "),(0,i.yg)("p",{parentName:"admonition"},"You can view the current price of storage on ",(0,i.yg)("a",{parentName:"p",href:"https://swarmscan.io/"},"Swarmscan"),".")),(0,i.yg)("h3",{id:"purchasing-storage"},"Purchasing Storage"),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.buyStorage")," method abstracts away some of the lower level details of "),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"When purchasing storage with ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.buyStorage"),", a postage batch will be bought with ",(0,i.yg)("em",{parentName:"p"},"at least")," enough space to upload the specified amount of data. However since storage on Swarm comes in ",(0,i.yg)("a",{parentName:"p",href:"/docs/storage/#batch-size-breakpoints"},(0,i.yg)("strong",{parentName:"a"},(0,i.yg)("em",{parentName:"strong"},"discrete sizes"))),", the actual amount of space will likely be greater than specified.")),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.buyStorage")," method takes instances of the ",(0,i.yg)("a",{parentName:"p",href:"/docs/storage/#utility-classes"},(0,i.yg)("inlineCode",{parentName:"a"},"Size")," and ",(0,i.yg)("inlineCode",{parentName:"a"},"Duration")," utility classes")," and purchases a postage batch which can upload ",(0,i.yg)("em",{parentName:"p"},"at least")," as much data as the given ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," and store it for the given ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," (the actual duration of storage may be longer or shorter depending on the change in storage price over time), and then save the postage batch data locally. The transaction usually only takes a few seconds but may take up to a minute."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Size, Duration } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Purchase a batch to store 1 GB \nconst batchId = await bee.buyStorage(Size.fromGigabytes(1), Duration.fromDays(1))\n")),(0,i.yg)("p",null,"Once the purchase transaction is complete, the method will return a unique postage batch id."),(0,i.yg)("p",null,"The lifetime of the batch starts counting down from the moment of purchase. The batch in the example above will expire in about 24 hours."),(0,i.yg)("h3",{id:"extending-storage-size"},"Extending Storage Size"),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"Just as with buying storage, since storage comes only in ",(0,i.yg)("a",{parentName:"p",href:"/docs/storage/#batch-size-breakpoints"},(0,i.yg)("strong",{parentName:"a"},(0,i.yg)("em",{parentName:"strong"},"discrete sizes"))),", the actual amount of additional space when extending the storage size of an existing batch will typically be greater than specified.")),(0,i.yg)("p",null,"If we need to upload more data, then we can extend a batch's storage size using the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.extendStorageSize")," method. Note that in order to increase the batch size using the ",(0,i.yg)("inlineCode",{parentName:"p"},"extendStorageSize")," method, you must choose a size which is above the current ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#batch-size-breakpoints"},"batch's size breakpoint"),"."),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"As mentioned ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#batch-size-breakpoints"},"above"),", the per byte cost decreases as the storage size of a batch increases, so it's more cost effective to increase the storage size an existing batch rather than buying a new, smaller batch."),(0,i.yg)("p",{parentName:"admonition"},"The exception to this rule is if we no longer wish to store the previously uploaded data. In that case we SHOULD buy an all new postage batch, as extending the size of an existing batch would require us to continue paying for the already uploaded data which we no longer need.")),(0,i.yg)("p",null,"First we estimate the cost to extend the storage size with the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.getSizeExtensionCost")," method:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Size } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\nconst batchId = batches[0].batchID\n\n// Instantiate a Size instance for 36 GB with newSize\nconst newSize = Size.fromGigabytes(5)\n\n// Return an instance of the BZZ class\nconst sizeExtentionCost = await bee.getSizeExtensionCost(batchId, newSize)\n\n// Use the BZZ.toDecimalString instance method to convert to a readable BZZ string\nconst cost = sizeExtentionCost.toDecimalString()\n\n// Prints current cost to increase size\nconsole.log(cost)\n")),(0,i.yg)("p",null,"If the price is acceptable, then we can proceed to extend the batch size using ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.extendStorageSize"),":"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Size } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\n// Print results to the terminal\nconsole.log(batches)\n\n// Get batch ID of first batch in list\nconst batchId = batches[0].batchID\n\n// Instantiate a Size instance for 36 GB with newSize\nconst newSize = Size.fromGigabytes(5)\n\n// Extends batch size and returns the batch ID \nconst result = await bee.extendStorageSize(batchId, newSize)\n\n// Log result if successful \nconsole.log(result)\n")),(0,i.yg)("p",null,"We can check that we successfully extended the batch size by ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#checking-storage-status"},"checking batch status"),":"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"[\n  {\n    batchID: BatchId { bytes: [Uint8Array], length: 32 },\n    utilization: 0,\n    usable: true,\n    label: '',\n    depth: 23,\n    amount: '1714407552',\n    bucketDepth: 16,\n    blockNumber: 39145214,\n    immutableFlag: true,\n    usage: 0,\n    usageText: '0%',\n    size: Size { bytes: 17028686336 },\n    remainingSize: Size { bytes: 17028686336 },\n    theoreticalSize: Size { bytes: 34359738368 },\n    duration: Duration { seconds: 94453 }\n  }\n]\n")),(0,i.yg)("p",null,"Here we can see that our batch ",(0,i.yg)("inlineCode",{parentName:"p"},"size")," was successfully extended from ~4.93 GB to ~17.03 GB. "),(0,i.yg)("p",null,(0,i.yg)("em",{parentName:"p"},"See ",(0,i.yg)("a",{parentName:"em",href:"/docs/buying-storage/#batch-size-breakpoints"},"above")," to understand why ",(0,i.yg)("inlineCode",{parentName:"em"},"size")," was extended to ~17.03 even though 5 GB was used as input.")),(0,i.yg)("h3",{id:"extending-storage-duration"},"Extending Storage Duration"),(0,i.yg)("p",null,"If we want our data to remain available on Swarm for a longer period of time, we can extend the duration of a postage batch using the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.extendStorageDuration")," method."),(0,i.yg)("p",null,"Extending the duration means adding more BZZ to the batch so that the data stays alive longer on the network."),(0,i.yg)("p",null,"Before extending the duration, we can estimate the cost using the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.getDurationExtensionCost")," method:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Duration } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\n// Select the batch ID of the first batch in the list\nconst batchId = batches[0].batchID\n\n// Create a new Duration instance for 0.01 days\nconst additionalDuration = Duration.fromDays(.01)\n\n// Estimate the cost of extending the duration\nconst durationExtensionCost = await bee.getDurationExtensionCost(batchId, additionalDuration)\n\n// Convert the BZZ value into a readable string\nconst cost = durationExtensionCost.toDecimalString()\n\n// Print the estimated cost\nconsole.log(cost)\n")),(0,i.yg)("p",null,"Once we know the cost and decide to proceed, we can use ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.extendStorageDuration")," to extend the batch duration:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Duration } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\n// Select the batch ID of the first batch in the list\nconst batchId = batches[0].batchID\n\n// Create a Duration instance for 0.1 additional days\nconst additionalDuration = Duration.fromDays(.01)\n\n// Extend the duration of the batch\nconst result = await bee.extendStorageDuration(batchId, additionalDuration)\n\n// Log the result\nconsole.log(result)\n")),(0,i.yg)("p",null,"We can verify that the extension was successful by ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#checking-storage-status"},"checking the batch status"),". You'll notice the ",(0,i.yg)("inlineCode",{parentName:"p"},"duration")," value on the batch will have increased, reflecting the newly extended storage time:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"[\n  {\n    batchID: BatchId { bytes: [Uint8Array], length: 32 },\n    utilization: 0,\n    usable: true,\n    label: '',\n    depth: 23,\n    amount: '1722164236',\n    bucketDepth: 16,\n    blockNumber: 39145214,\n    immutableFlag: true,\n    usage: 0,\n    usageText: '0%',\n    size: Size { bytes: 17028686336 },\n    remainingSize: Size { bytes: 17028686336 },\n    theoreticalSize: Size { bytes: 34359738368 },\n    duration: Duration { seconds: 94132 }\n  }\n]\n")),(0,i.yg)("p",null,"Here we can see that the ",(0,i.yg)("inlineCode",{parentName:"p"},"duration")," value (measured in seconds) has increased, confirming that the batch will now remain alive on the Swarm network for longer."),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"If you're storing important or long-lived data, it's a good idea to periodically check and extend the duration of your batches to ensure your data doesn't expire unexpectedly.")),(0,i.yg)("h3",{id:"estimating-combined-size-and-duration-extension-cost"},"Estimating Combined Size and Duration Extension Cost"),(0,i.yg)("p",null,"If we want to ",(0,i.yg)("strong",{parentName:"p"},"increase both the storage size and duration")," of a postage batch, we can use the ",(0,i.yg)("inlineCode",{parentName:"p"},"Bee.getExtensionCost")," method to estimate the ",(0,i.yg)("strong",{parentName:"p"},"total cost")," of the extension. This is useful when you're planning to keep data alive for longer ",(0,i.yg)("em",{parentName:"p"},"and")," want to increase capacity for uploading more data at the same time."),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"getExtensionCost")," method combines both aspects \u2014 size and duration \u2014 into a single cost calculation, making it easier to understand the overall expense upfront."),(0,i.yg)("p",null,"Here\u2019s how to use it:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee, Size, Duration } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\n// Choose a batch to extend\nconst batchId = batches[0].batchID\n\n// Define a new desired size (e.g., 10 GB)\nconst newSize = Size.fromGigabytes(10)\n\n// Define a new additional duration (e.g., 14 days)\nconst additionalDuration = Duration.fromDays(14)\n\n// Estimate total BZZ cost for extending both size and duration\nconst totalCost = await bee.getExtensionCost(batchId, newSize, additionalDuration)\n\n// Convert to a readable string\nconst cost = totalCost.toDecimalString()\n\n// Print total estimated cost\nconsole.log(cost)\n")),(0,i.yg)("p",null,"This method helps you determine if it's more economical to ",(0,i.yg)("strong",{parentName:"p"},"extend")," an existing batch or ",(0,i.yg)("strong",{parentName:"p"},"create a new one"),", especially when both dimensions\u2014storage and time\u2014need to grow."),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"If you're unsure whether to extend a batch or start fresh, compare the output of ",(0,i.yg)("inlineCode",{parentName:"p"},"getExtensionCost")," with the cost of a new batch using the ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#batch-size-breakpoints"},"Postage Stamp Pricing Guide"),". In many cases, extending is cheaper, especially for larger and longer-lived batches.")),(0,i.yg)("p",null,"If you're happy with the cost, you can then proceed to extend the ",(0,i.yg)("strong",{parentName:"p"},"size")," and ",(0,i.yg)("strong",{parentName:"p"},"duration")," individually by calling ",(0,i.yg)("inlineCode",{parentName:"p"},"extendStorageSize")," and ",(0,i.yg)("inlineCode",{parentName:"p"},"extendStorageDuration")," as shown in the previous sections."),(0,i.yg)("h3",{id:"checking-batch-status"},"Checking Batch Status"),(0,i.yg)("p",null,"You can check the status of purchased batches using the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.getAllPostageBatch")," method:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee } from \"@ethersphere/bee-js\"\n\nconst bee = new Bee('http://localhost:1633')\n\n// Request all local postage batches\nconst batches = await bee.getAllPostageBatch()\n\n// Print results to the terminal\nconsole.log(batches) \n")),(0,i.yg)("p",null,"The results printed to the terminal will include all the currently valid postage batches we've purchased:"),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-bash"},"[\n  {\n    batchID: BatchId { bytes: [Uint8Array], length: 32 },\n    utilization: 0,\n    usable: true,\n    label: '',\n    depth: 22,\n    amount: '931958784',\n    bucketDepth: 16,\n    blockNumber: 39105960,\n    immutableFlag: true,\n    usage: 0,\n    usageText: '0%',\n    size: Size { bytes: 4925468496 },\n    remainingSize: Size { bytes: 4925468496 },\n    theoreticalSize: Size { bytes: 17179869184 },\n    duration: Duration { seconds: 84348 }\n  }\n]\n")),(0,i.yg)("p",null,"We can disregard many of these values since they are only needed for advanced usage. There are several values we do need to pay attention to however:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"usable")," - it takes a short time for a batch to become usable (usually less than a minute) after purchase. Once usable, ",(0,i.yg)("inlineCode",{parentName:"li"},"usable")," will change from ",(0,i.yg)("inlineCode",{parentName:"li"},"false")," to ",(0,i.yg)("inlineCode",{parentName:"li"},"true"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"usage")," - indicates how much of the batch has been used as a value between ",(0,i.yg)("inlineCode",{parentName:"li"},"1")," and ",(0,i.yg)("inlineCode",{parentName:"li"},"0"),"."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"usageText")," - converts the ",(0,i.yg)("inlineCode",{parentName:"li"},"usage")," value to a percentage value rounded to the nearest whole number which is then converted to text."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"size")," -  the amount of data in bytes which the batch can safely store."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"remainingSize")," - the amount of date in bytes remaining from ",(0,i.yg)("inlineCode",{parentName:"li"},"size")," which is still available to be used."),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration")," - an estimate of the remaining batch lifetime in seconds.")),(0,i.yg)("p",null,'For an explanation of the remaining values, refer to the "Advanced" section below.'),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"Note that although 1 GB was specified as input for the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.buyStorage"),", the ",(0,i.yg)("inlineCode",{parentName:"p"},"size")," value is ~4.93 GB. Refer to the ",(0,i.yg)("a",{parentName:"p",href:"/docs/buying-storage/#batch-size-breakpoints"},"section about batch sizes")," above to understand why.")),(0,i.yg)("h3",{id:"selecting-a-batch"},"Selecting a Batch"),(0,i.yg)("p",null,"Any method in ",(0,i.yg)("inlineCode",{parentName:"p"},"bee-js")," which writes data to Swarm requires the batch id of a valid, usable postage batch with remaining space to upload data. "),(0,i.yg)("p",null,"The example script below exports a function which looks for the first usable postage batch with remaining space and returns the id of the batch. "),(0,i.yg)("admonition",{title:"notice",type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"This function is used throughout the examples here in the docs.")),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee } from '@ethersphere/bee-js'\n\nconst bee = new Bee('http://localhost:1633')\n\nexport async function getBatch(bee, criteriaFn) {\n  const batches = await bee.getAllPostageBatch()\n  const matchingBatch = batches.find(criteriaFn)\n\n  if (!matchingBatch) {\n    throw new Error('No postage batch matched the provided criteria.')\n  }\n\n  return matchingBatch.batchID.toString()\n}\n")),(0,i.yg)("p",null,"To use it, save the script to a file called ",(0,i.yg)("inlineCode",{parentName:"p"},"getBatch.js")," so we can import the it in our other scripts."),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Bee } from '@ethersphere/bee-js'\nimport { getBatch } from './getBatch'\n\nconst bee = new Bee('http://localhost:1633')\n\n// Define the selection criteria as a named function\nfunction isUsableWithFreeSpace(batch) {\n  return batch.usable && batch.remainingSize?.bytes > 0\n}\n\nconst batchId = getBatch(bee, isUsableWithFreeSpace)\n")),(0,i.yg)("p",null,"If you need a batch with specific characteristics (such as a batch with at least 10 GB remaining space or a mutable batch), then you should ",(0,i.yg)("a",{parentName:"p",href:"/docs/storage/#checking-batch-status"},"inspect")," your postage batches' status using ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.getAllPostageBatch")," in order to check if a batch with your desired characteristics exists and return its id."),(0,i.yg)("h3",{id:"batch-size-breakpoints"},"Batch Size Breakpoints"),(0,i.yg)("p",null,"Batches are bought in discrete size intervals as shown in the table below."),(0,i.yg)("p",null,"As the effective volume increases, so does the discount percentage, which eventually converges to around 68% with larger volumes. "),(0,i.yg)("p",null,(0,i.yg)("em",{parentName:"p"},"Costs are recorded at time of writing and are subject to change. Use the ",(0,i.yg)("inlineCode",{parentName:"em"},"bee.getStorageCost")," method for current price.")),(0,i.yg)("table",null,(0,i.yg)("thead",{parentName:"table"},(0,i.yg)("tr",{parentName:"thead"},(0,i.yg)("th",{parentName:"tr",align:null},"Breakpoint"),(0,i.yg)("th",{parentName:"tr",align:null},"Effective Volume"),(0,i.yg)("th",{parentName:"tr",align:null},"xBZZ / day / GB Cost"),(0,i.yg)("th",{parentName:"tr",align:null},"% Discount"))),(0,i.yg)("tbody",{parentName:"table"},(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"1"),(0,i.yg)("td",{parentName:"tr",align:null},"4.93 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.066"),(0,i.yg)("td",{parentName:"tr",align:null},"0%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"2"),(0,i.yg)("td",{parentName:"tr",align:null},"17.03 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.038"),(0,i.yg)("td",{parentName:"tr",align:null},"42%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"3"),(0,i.yg)("td",{parentName:"tr",align:null},"44.21 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.030"),(0,i.yg)("td",{parentName:"tr",align:null},"55%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"4"),(0,i.yg)("td",{parentName:"tr",align:null},"102.78 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.025"),(0,i.yg)("td",{parentName:"tr",align:null},"62%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"5"),(0,i.yg)("td",{parentName:"tr",align:null},"225.86 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.023"),(0,i.yg)("td",{parentName:"tr",align:null},"65%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"6"),(0,i.yg)("td",{parentName:"tr",align:null},"480.43 GB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.022"),(0,i.yg)("td",{parentName:"tr",align:null},"67%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"7"),(0,i.yg)("td",{parentName:"tr",align:null},"1.00 TB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.021"),(0,i.yg)("td",{parentName:"tr",align:null},"68%")),(0,i.yg)("tr",{parentName:"tbody"},(0,i.yg)("td",{parentName:"tr",align:null},"8"),(0,i.yg)("td",{parentName:"tr",align:null},"2.06 TB"),(0,i.yg)("td",{parentName:"tr",align:null},"0.021"),(0,i.yg)("td",{parentName:"tr",align:null},"68%")))),(0,i.yg)("p",null,"When purchasing a batch / estimating batch price, ",(0,i.yg)("inlineCode",{parentName:"p"},"bee-js")," will round up to the nearest effective volume."),(0,i.yg)("p",null,"For example, if the ",(0,i.yg)("inlineCode",{parentName:"p"},"bee.buyStorage")," method is used to buy a batch with 1 GB as input, ",(0,i.yg)("inlineCode",{parentName:"p"},"bee-js")," will round up to the first breakpoint and buy a batch with 4.93 GB effective volume. If 5 GB is used as input, then ",(0,i.yg)("inlineCode",{parentName:"p"},"bee-js")," will round up to the second breakpoint of 17.03 GB since 5 GB is larger than the first breakpoint of 4.93 GB.  "),(0,i.yg)("p",null,"Refer to the ",(0,i.yg)("a",{parentName:"p",href:"https://docs.ethswarm.org/docs/concepts/incentives/postage-stamps#effective-utilisation-table"},"Bee documentation")," for a more in-depth understanding of batch utilization."),(0,i.yg)("h3",{id:"utility-classes"},"Utility Classes"),(0,i.yg)("h4",{id:"size"},(0,i.yg)("inlineCode",{parentName:"h4"},"Size")),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," class represents a storage size in ",(0,i.yg)("strong",{parentName:"p"},"bytes"),", with helper methods for creating and converting values."),(0,i.yg)("h5",{id:"creating-a-size-instance"},"Creating a Size instance"),(0,i.yg)("p",null,"The class includes two ",(0,i.yg)("em",{parentName:"p"},"static")," methods for creating an instance of the ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," class from either raw bytes or from gigabytes:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Size.fromBytes")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Size.fromGigabytes"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Size } from '@ethersphere/bee-js'\n\n// Create a Size instance from raw bytes\nconst sizeA = Size.fromBytes(5000000000)\n\n// Or from gigabytes\nconst sizeB = Size.fromGigabytes(5) // \u2192 5 GB = 5,000,000,000 bytes\n")),(0,i.yg)("h5",{id:"converting-and-formatting"},"Converting and formatting"),(0,i.yg)("p",null,"The class also includes three ",(0,i.yg)("em",{parentName:"p"},"instance")," methods for getting the value from an existing ",(0,i.yg)("inlineCode",{parentName:"p"},"Size")," instance as either raw bytes, gigabytes, or formatted text:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"size.toBytes")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"size.toGigabytes")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"size.toFormattedString"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"// Using `sizeB` from the previous example\n\nsizeB.toBytes()          // \u2192 5000000000\nsizeB.toGigabytes()      // \u2192 5\nsizeB.toFormattedString() // \u2192 '5.00 GB'\n")),(0,i.yg)("h4",{id:"duration"},(0,i.yg)("inlineCode",{parentName:"h4"},"Duration")),(0,i.yg)("p",null,"The ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," class represents a length of time in ",(0,i.yg)("strong",{parentName:"p"},"seconds"),", with helper methods for creating and converting durations in various common time units."),(0,i.yg)("admonition",{type:"tip"},(0,i.yg)("p",{parentName:"admonition"},"All of the helper methods for ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," take numbers as input except for ",(0,i.yg)("inlineCode",{parentName:"p"},"toEndDate")," ",(0,i.yg)("inlineCode",{parentName:"p"},"fromEndDate")," which both take a ",(0,i.yg)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date"},(0,i.yg)("inlineCode",{parentName:"a"},"Date"))," object as input.")),(0,i.yg)("h5",{id:"creating-a-duration-instance"},"Creating a Duration instance"),(0,i.yg)("p",null,"The class includes several ",(0,i.yg)("em",{parentName:"p"},"static")," methods for creating a ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," instance from values like milliseconds, seconds, days, or even from dates:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromMilliseconds")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromSeconds")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromHours")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromDays")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromWeeks")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromYears")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"Duration.fromEndDate"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"import { Duration } from '@ethersphere/bee-js'\n\n// Create a duration of 3 days\nconst durationA = Duration.fromDays(3)\n\n// Create a duration from now until a future date\nconst endDate = new Date('2025-04-01T12:00:00Z')\nconst durationB = Duration.fromEndDate(endDate)\n")),(0,i.yg)("h5",{id:"converting-and-formatting-1"},"Converting and formatting"),(0,i.yg)("p",null,"The class also includes several ",(0,i.yg)("em",{parentName:"p"},"instance")," methods for converting a ",(0,i.yg)("inlineCode",{parentName:"p"},"Duration")," instance into different time units or for getting a future date from a starting point:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toSeconds")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toHours")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toDays")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toWeeks")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toYears")),(0,i.yg)("li",{parentName:"ul"},(0,i.yg)("inlineCode",{parentName:"li"},"duration.toEndDate"))),(0,i.yg)("pre",null,(0,i.yg)("code",{parentName:"pre",className:"language-javascript"},"// Using `durationA` from the previous example\n\ndurationA.toSeconds()       // \u2192 259200\ndurationA.toDays()          // \u2192 3\ndurationA.toEndDate()       // \u2192 Date object 3 days from now\n\n// You can also specify a custom starting date\nconst startDate = new Date('2025-01-01T00:00:00Z')\ndurationA.toEndDate(startDate) // \u2192 Date object 3 days after Jan 1\n")),(0,i.yg)("p",null,"This class is useful when:"),(0,i.yg)("ul",null,(0,i.yg)("li",{parentName:"ul"},"Setting how long data should remain available in Swarm"),(0,i.yg)("li",{parentName:"ul"},"Estimating or displaying expiration time for postage batches"),(0,i.yg)("li",{parentName:"ul"},"Working with ",(0,i.yg)("inlineCode",{parentName:"li"},"bee.buyStorage"),", ",(0,i.yg)("inlineCode",{parentName:"li"},"bee.getStorageCost"),", or ",(0,i.yg)("inlineCode",{parentName:"li"},"bee.extendStorageDuration"))))}d.isMDXComponent=!0}}]);