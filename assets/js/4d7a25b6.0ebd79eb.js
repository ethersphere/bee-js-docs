"use strict";(self.webpackChunkbee_js_docs=self.webpackChunkbee_js_docs||[]).push([[344],{5446:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>l,default:()=>g,frontMatter:()=>r,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"documentation/tracking-uploads","title":"Tracking Uploads","description":"You can track the progress of deferred uploads using \\"tags\\". Each tag tracks how many chunks were split, stored, seen, and synced by the network. By creating a tag before uploading and passing it to the upload function, you make the upload *trackable, allowing you to confirm whether your uploaded data has been fully synced.","source":"@site/docs/documentation/tracking-uploads.md","sourceDirName":"documentation","slug":"/tracking-uploads","permalink":"/docs/tracking-uploads","draft":false,"unlisted":false,"editUrl":"https://github.com/ethersphere/bee-js-docs/docs/documentation/tracking-uploads.md","tags":[],"version":"current","frontMatter":{"title":"Tracking Uploads","id":"tracking-uploads","slug":"/tracking-uploads","sidebar_label":"Tracking Uploads"},"sidebar":"Balls","previous":{"title":"Upload and Download","permalink":"/docs/upload-download"},"next":{"title":"Pinning","permalink":"/docs/pinning"}}');var s=a(4848),o=a(8453);const r={title:"Tracking Uploads",id:"tracking-uploads",slug:"/tracking-uploads",sidebar_label:"Tracking Uploads"},l=void 0,i={},d=[{value:"How It Works",id:"how-it-works",level:2},{value:"1. Create a Tag",id:"1-create-a-tag",level:3},{value:"2. Upload a File with the Tag",id:"2-upload-a-file-with-the-tag",level:3},{value:"3. Track Tag Progress",id:"3-track-tag-progress",level:3},{value:"Example Script",id:"example-script",level:2},{value:"Example Terminal Output",id:"example-terminal-output",level:3},{value:"Deleting Tags",id:"deleting-tags",level:2},{value:"References",id:"references",level:2}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:['You can track the progress of deferred uploads using "tags". Each tag tracks how many chunks were ',(0,s.jsx)(n.strong,{children:"split"}),", ",(0,s.jsx)(n.strong,{children:"stored"}),", ",(0,s.jsx)(n.strong,{children:"seen"}),", and ",(0,s.jsx)(n.strong,{children:"synced"})," by the network. By creating a tag before uploading and passing it to the upload function, you make the upload *trackable, allowing you to confirm whether your uploaded data has been fully synced."]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["Tracking with tags is used ",(0,s.jsx)(n.em,{children:(0,s.jsxs)(n.strong,{children:["only for ",(0,s.jsx)(n.a,{href:"/docs/upload-download/#deferred-uploads",children:"deferred uploads"})]})}),". That is because when content is uploaded in a deferred manner, the content's reference hash will be returned ",(0,s.jsx)(n.em,{children:"immediately"}),", often before the content has been fully synced to the network. Therefore tags should be used in order to confirm when the content has been fully synced and is retrievable."]}),(0,s.jsx)(n.p,{children:"With direct uploads, the reference hash is not returned until after the content has already been uploaded and fully synced to the network, so there is no need to track it after uploading."})]}),"\n",(0,s.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,s.jsx)(n.h3,{id:"1-create-a-tag",children:"1. Create a Tag"}),"\n",(0,s.jsxs)(n.p,{children:["Before uploading, create a new tag using ",(0,s.jsx)(n.code,{children:"bee.createTag()"}),". This returns a unique tag UID that will be used to monitor the upload."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'const tag = await bee.createTag()\nconsole.log("Created new tag with UID:", tag.uid)\n'})}),"\n",(0,s.jsxs)(n.p,{children:["Alternatively, you can use an existing tag from ",(0,s.jsx)(n.code,{children:"bee.getAllTags()"})," (useful for testing or reuse):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'const allTags = await bee.getAllTags()\nif (allTags.length > 0) {\n  tag = allTags[0]\n  console.log("Using existing tag with UID:", tag.uid)\n}\n'})}),"\n",(0,s.jsx)(n.h3,{id:"2-upload-a-file-with-the-tag",children:"2. Upload a File with the Tag"}),"\n",(0,s.jsxs)(n.p,{children:["To enable tracking, pass the tag UID into the upload options under the ",(0,s.jsx)(n.code,{children:"tag"})," key:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const result = await bee.uploadFile(postageBatchId, fileData, 'nodes.json', {\n  tag: tag.uid,\n  contentType: 'application/json'\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"This links the upload to your tag so you can monitor its progress."}),"\n",(0,s.jsx)(n.h3,{id:"3-track-tag-progress",children:"3. Track Tag Progress"}),"\n",(0,s.jsxs)(n.p,{children:["Use ",(0,s.jsx)(n.code,{children:"bee.retrieveTag(tagUid)"})," to monitor upload progress. Chunks that have ",(0,s.jsx)(n.strong,{children:"already been synced in the past"})," are counted in ",(0,s.jsx)(n.code,{children:"seen"}),", while newly synced ones are in ",(0,s.jsx)(n.code,{children:"synced"}),". Poll repeatedly until:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-text",children:"synced + seen === split\n"})}),"\n",(0,s.jsx)(n.p,{children:"This indicates that all chunks have either just synced or were already present in the network."}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:"const tag = await bee.retrieveTag(tagUid)\nconsole.log(` - Total split: ${tag.split}`)\nconsole.log(` - Synced: ${tag.synced}`)\nconsole.log(` - Seen: ${tag.seen}`)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"example-script",children:"Example Script"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'import { Bee } from "@ethersphere/bee-js"\nimport fs from "fs/promises"\n\nconst bee = new Bee(\'http://localhost:1633\')\nconst postageBatchId = "129903062bedc4eca6fc1c232ed385e93dda72f711caa1ead6018334dd801cee"\n\nasync function waitForTagSync(tagUid, interval = 800) {\n  while (true) {\n    const tag = await bee.retrieveTag(tagUid)\n\n    console.log(`Progress (Tag ${tagUid}):`)\n    console.log(` - Total split: ${tag.split}`)\n    console.log(` - Stored: ${tag.stored}`)\n    console.log(` - Seen: ${tag.seen}`)\n    console.log(` - Synced: ${tag.synced}`)\n\n    if (tag.split > 0 && tag.synced + tag.seen >= tag.split) {\n      console.log("Upload fully synced!")\n      break\n    }\n\n    await new Promise(resolve => setTimeout(resolve, interval))\n  }\n}\n\nasync function uploadNodesJsonWithTag() {\n  try {\n    const fileData = await fs.readFile(\'./nodes.json\')\n\n    const tag = await bee.createTag()\n    console.log("Created new tag with UID:", tag.uid)\n\n    const result = await bee.uploadFile(postageBatchId, fileData, \'nodes.json\', {\n      tag: tag.uid,\n      contentType: \'application/json\'\n    })\n\n    console.log("Uploaded reference:", result.reference.toHex())\n\n    await waitForTagSync(tag.uid)\n  } catch (error) {\n    console.error("Error uploading nodes.json:", error.message)\n  }\n}\n\nuploadNodesJsonWithTag()\n'})}),"\n",(0,s.jsx)(n.h3,{id:"example-terminal-output",children:"Example Terminal Output"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Created new tag with UID: 85\nUploaded reference: 78e5247e97b1a3362b6c3f054924dce734e0ffd7df0cb5ed9b636cb6a4a14d93\nProgress (Tag 85):\n - Total split: 1078\n - Stored: 0\n - Seen: 0\n - Synced: 546\nProgress (Tag 85):\n - Total split: 1078\n - Stored: 0\n - Seen: 0\n - Synced: 1078\nUpload fully synced!\n"})}),"\n",(0,s.jsx)(n.h2,{id:"deleting-tags",children:"Deleting Tags"}),"\n",(0,s.jsx)(n.p,{children:"You can delete tags you no longer need using their uid:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-js",children:'await bee.deleteTag(tag.uid)\nconsole.log("Deleted tag:", tag.uid)\n'})}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://docs.ethswarm.org/docs/develop/access-the-swarm/syncing",children:"Bee docs \u2013 Syncing / Tags"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsxs)(n.a,{href:"https://docs.ethswarm.org/api/#tag/Tag",children:["Bee API Reference \u2013 ",(0,s.jsx)(n.code,{children:"/tags"})]})}),"\n"]})]})}function g(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>l});var t=a(6540);const s={},o=t.createContext(s);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);