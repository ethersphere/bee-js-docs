"use strict";(self.webpackChunkbee_js_docs=self.webpackChunkbee_js_docs||[]).push([[76],{3738:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"documentation/pss","title":"Postal Service over Swarm","description":"Swarm supports sending encrypted messages over the network using a system called Postal Service over Swarm (PSS). These messages are embedded in regular Swarm traffic and routed to specific nodes based on their overlay address.","source":"@site/docs/documentation/pss.md","sourceDirName":"documentation","slug":"/pss","permalink":"/docs/pss","draft":false,"unlisted":false,"editUrl":"https://github.com/ethersphere/bee-js-docs/docs/documentation/pss.md","tags":[],"version":"current","frontMatter":{"title":"Postal Service over Swarm","id":"pss","slug":"/pss","sidebar_label":"PSS"},"sidebar":"Balls","previous":{"title":"Staking","permalink":"/docs/staking"},"next":{"title":"GSOC","permalink":"/docs/gsoc"}}');var t=n(4848),r=n(8453);const o={title:"Postal Service over Swarm",id:"pss",slug:"/pss",sidebar_label:"PSS"},c=void 0,a={},d=[{value:"What Is PSS?",id:"what-is-pss",level:2},{value:"Requirements",id:"requirements",level:2},{value:"Get Recipient Info (Full Node Only)",id:"get-recipient-info-full-node-only",level:2},{value:"Listen for Messages (Full Node)",id:"listen-for-messages-full-node",level:2},{value:"Send Message (Light or Full Node)",id:"send-message-light-or-full-node",level:2},{value:"Encrypt with PSS Public Key",id:"encrypt-with-pss-public-key",level:2}];function l(e){const s={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["Swarm supports sending encrypted messages over the network using a system called ",(0,t.jsx)(s.strong,{children:"Postal Service over Swarm"})," (PSS). These messages are embedded in regular Swarm traffic and routed to specific nodes based on their overlay address."]}),"\n",(0,t.jsx)(s.h2,{id:"what-is-pss",children:"What Is PSS?"}),"\n",(0,t.jsxs)(s.p,{children:["PSS provides a pub/sub-like functionality for secure messaging. Full nodes can listen for messages on a specific ",(0,t.jsx)(s.strong,{children:"topic"}),", and other nodes (light or full) can send them payloads using the recipient node's ",(0,t.jsx)(s.strong,{children:"overlay address"})," and optionally encrypted using the recipient's ",(0,t.jsx)(s.strong,{children:"PSS public key"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["Messages can be received via ",(0,t.jsx)(s.strong,{children:"subscription"})," or by a ",(0,t.jsx)(s.strong,{children:"one-off listener"}),"."]}),"\n",(0,t.jsx)(s.admonition,{type:"caution",children:(0,t.jsx)(s.p,{children:"Only full nodes can receive messages since PSS messages are sent as a part of the chunk syncing process which only full nodes take part in."})}),"\n",(0,t.jsx)(s.h2,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(s.p,{children:"To use the example scripts below, you need:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"A Bee full node with a fully synced reserve for receiving PSS messages."}),"\n",(0,t.jsx)(s.li,{children:"A light node for sending PSS messages."}),"\n",(0,t.jsxs)(s.li,{children:["The batch ID of a usable postage batch. If you don't have one already, you will need to ",(0,t.jsx)(s.a,{href:"/docs/storage/#purchasing-storage",children:"buy a batch"})," to upload data. If you do have one, you will need to ",(0,t.jsx)(s.a,{href:"/docs/storage/#selecting-a-batch",children:"get and save"})," its batch ID."]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"get-recipient-info-full-node-only",children:"Get Recipient Info (Full Node Only)"}),"\n",(0,t.jsxs)(s.p,{children:["This step ",(0,t.jsx)(s.strong,{children:"must be performed by the receiving full node"}),". It retrieves the node\u2019s ",(0,t.jsx)(s.strong,{children:"overlay address"})," and ",(0,t.jsx)(s.strong,{children:"PSS public key"}),", which must then be shared with the sending node:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["The ",(0,t.jsx)(s.strong,{children:"overlay address"})," is ",(0,t.jsx)(s.strong,{children:"required"})," as the routing target."]}),"\n",(0,t.jsxs)(s.li,{children:["The ",(0,t.jsx)(s.strong,{children:"PSS public key"})," is ",(0,t.jsx)(s.strong,{children:"optional"})," and only needed for encryption."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"import { Bee } from '@ethersphere/bee-js'\n\nconst bee = new Bee('http://localhost:1633')\n\nasync function checkAddresses() {\n  const addresses = await bee.getNodeAddresses()\n\n  console.log('Node Addresses:', addresses)\n}\n\ncheckAddresses()\n"})}),"\n",(0,t.jsx)(s.p,{children:"Example output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"Node Addresses:\nOverlay: 1e2054bec3e681aeb0b365a1f9a574a03782176bd3ec0bcf810ebcaf551e4070\nEthereum: 9a73f283cd9211b96b5ec63f7a81a0ddc847cd93\nPublic Key: 7d0c4759f689ea3dd3eb79222870671c492cb99f3fade275bcbf0ea39cd0ef6e25edd43c99985983e49aa528f3f2b6711085354a31acb4e7b03559b02ec868f0\nPSS Public Key: 5ade58d20be7e04ee8f875eabeebf9c53375a8fc73917683155c7c0b572f47ef790daa3328f48482663954d12f6e4739f748572c1e86bfa89af99f17e7dd4d33\nUnderlay: [\n  '/ip4/127.0.0.1/tcp/1634/p2p/QmcpSJPHuuQYRgDkNfwziihVcpuVteoNxePvfzaJyp9z7j',\n  '/ip4/172.17.0.2/tcp/1634/p2p/QmcpSJPHuuQYRgDkNfwziihVcpuVteoNxePvfzaJyp9z7j',\n  '/ip6/::1/tcp/1634/p2p/QmcpSJPHuuQYRgDkNfwziihVcpuVteoNxePvfzaJyp9z7j'\n]\n"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"Overlay"})," and ",(0,t.jsx)(s.code,{children:"PSS Public Key"})," values should be shared with the sending node."]}),"\n",(0,t.jsxs)(s.p,{children:["The sender (which can be a light node or a full node) needs the ",(0,t.jsx)(s.strong,{children:"overlay address"})," to generate the message target, and can optionally use the ",(0,t.jsx)(s.strong,{children:"PSS public key"})," to encrypt the message."]}),"\n",(0,t.jsx)(s.h2,{id:"listen-for-messages-full-node",children:"Listen for Messages (Full Node)"}),"\n",(0,t.jsxs)(s.p,{children:["You can listen on a topic using both ",(0,t.jsx)(s.strong,{children:"continuous subscription"})," and ",(0,t.jsx)(s.strong,{children:"one-time receive"}),":"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"bee.pssSubscribe()"})," is used to set up a continuous subscription."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"bee.pssReceive()"})," is used to set up a listener on a timeout which closes after receiving a message."]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"import { Bee, Topic } from '@ethersphere/bee-js'\n\nconst bee = new Bee('http://localhost:1633')\n\n// Generate a topic from a unique string\nconst topic = Topic.fromString('pss-demo')\n\nconsole.log('Subscribing to topic:', topic.toHex())\n\n// Continuous subscription\nbee.pssSubscribe(topic, {\n  onMessage: msg => console.log('Received via subscription:', msg.toUtf8()),\n  onError: err => console.error('Subscription error:', err.message),\n})\n\n// One-time receive (3 hour timeout)\nasync function receiveOnce() {\n  try {\n    console.log('Waiting for one-time message...')\n    const message = await bee.pssReceive(topic, 1000 * 60 * 60 * 3)\n    console.log('One-time received:', message.toUtf8())\n  } catch (err) {\n    console.error('pssReceive error or timeout:', err.message)\n  }\n}\n\nreceiveOnce()\n"})}),"\n",(0,t.jsxs)(s.p,{children:["In this script we generate a ",(0,t.jsx)(s.code,{children:"topic"})," from our chosen string with the ",(0,t.jsx)(s.code,{children:"Topic.fromString()"})," method. Then we subscribe to listen for incoming pss messages for that topic with the ",(0,t.jsx)(s.code,{children:"bee.pssSubscribe()"})," method, and we also set up a listener for receiving a single message with the ",(0,t.jsx)(s.code,{children:"bee.pssReceive()"})," method. When a chunk with a PSS message for that topic is synced into our node's neighborhood, it will be received and handled by our node with the ",(0,t.jsx)(s.code,{children:"onMessage"})," callback function when using the ",(0,t.jsx)(s.code,{children:"bee.pssSubscribe()"})," or through the return value of the ",(0,t.jsx)(s.code,{children:"bee.pssReceive()"})," method in our ",(0,t.jsx)(s.code,{children:"receiveOnce"})," function."]}),"\n",(0,t.jsx)(s.h2,{id:"send-message-light-or-full-node",children:"Send Message (Light or Full Node)"}),"\n",(0,t.jsx)(s.p,{children:"The sender must provide:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["A valid ",(0,t.jsx)(s.strong,{children:"postage batch ID"})]}),"\n",(0,t.jsxs)(s.li,{children:["The recipient\u2019s ",(0,t.jsx)(s.strong,{children:"overlay address"})," (used to generate the routing target)"]}),"\n",(0,t.jsxs)(s.li,{children:["Optionally the ",(0,t.jsx)(s.strong,{children:"PSS public key"})," for encryption"]}),"\n"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"import { Bee, Topic, Utils } from '@ethersphere/bee-js'\n\nconst bee = new Bee('http://localhost:1643')\nconst BATCH_ID = '6d8118c693423eef41796d58edbbffb76881806a0f44da728bf80f0c1aafa783'\n\n// The overlay address of the receiving node\nconst recipientOverlay = '1e2054bec3e681aeb0b365a1f9a574a03782176bd3ec0bcf810ebcaf551e4070'\n\n// Generate a topic using the same string shared by the receiving node\nconst topic = Topic.fromString('pss-demo')\n\n// Set the number of leading prefix bits to mine for the chunk bearing the PSS message \nconst target = Utils.makeMaxTarget(recipientOverlay)\n\n// The PSS message payload\nconst message = 'Hello from the light node!'\n\nasync function send() {\n  try {\n    await bee.pssSend(BATCH_ID, topic, target, message)\n    console.log('Message sent via PSS.')\n  } catch (err) {\n    console.error('Failed to send message:', err.message)\n  }\n}\n\nsend()\n"})}),"\n",(0,t.jsx)(s.h2,{id:"encrypt-with-pss-public-key",children:"Encrypt with PSS Public Key"}),"\n",(0,t.jsxs)(s.p,{children:["To encrypt the message specifically for the recipient, include their ",(0,t.jsx)(s.strong,{children:"PSS public key"})," in the send call:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-js",children:"const recipientPssPublicKey = '5ade58d20be7e04ee8f875eabeebf9c53375a8fc73917683155c7c0b572f47ef790daa3328f48482663954d12f6e4739f748572c1e86bfa89af99f17e7dd4d33'\n\nawait bee.pssSend(BATCH_ID, topic, target, message, recipientPssPublicKey)\n"})}),"\n",(0,t.jsx)(s.p,{children:"The message will then be encrypted using the PSS public key of the recipient node before sending and will only be decryptable by the recipient node (although the message bearing the PSS chunk will be received by all nodes in the same neighborhood as the recipient, it will only be decryptable by the recipient node)."})]})}function h(e={}){const{wrapper:s}={...(0,r.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>c});var i=n(6540);const t={},r=i.createContext(t);function o(e){const s=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:s},e.children)}}}]);